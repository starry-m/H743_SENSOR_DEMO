# 基于 STM32H743+SENSOR 板的可视化感知交互系统

板载传感器：
LSM6DSO16IS：MEMS 3D 加速度计 + 3D 陀螺仪 与 ISPU
LIS2MDL：MEMS 3D 磁力计
LIS2DUXS12：超低功耗 MEMS 3 轴加速度计
LPS22DF:低功率和高精度 MEMS 绝对数字输出气压计
SHT40AD1B：高精度超低功耗的温湿度传感器
STTS22H：低电压，超低功耗，0.5°C 精度的温度传感器
LSM6DSV16X：MEMS 3D 加速度计+ 3D 陀螺仪

| Motion      | ID  | ACCELEROMETER | GYROSCOPE | MAGNETOMETER |
| ----------- | --- | ------------- | --------- | ------------ |
| LIS2MDL     | 0   | &#10006;      | &#10006;  | &#10004;     |
| LSM6DSV16X  | 1   | &#10004;      | &#10004;  | &#10006;     |
| LIS2DUXS12  | 2   | &#10004;      | &#10006;  | &#10006;     |
| LSM6DSO16IS | 3   | &#10004;      | &#10004;  | &#10006;     |

| Environmental | ID  | TEMPERATURE | PRESSURE | HUMIDITY |
| ------------- | --- | ----------- | -------- | -------- |
| STTS22H       | 0   | &#10004;    | &#10006; | &#10006; |
| LPS22DF       | 1   | &#10004;    | &#10004; | &#10006; |
| SHT40AD1B     | 2   | &#10004;    | &#10006; | &#10004; |

`QVAR 动作分析`
|动作||||
|-|-|-|-|
|||||

$\Delta$t 大概为 30ms

`左单击`:0-> 1 ->0
`右单击`:0-> -1 ->0

$\Delta$t 大概为 20ms

`左双击`:0->1->0->1->0
`右双击`:0->-1->0->-1->0

$\Delta$t 大概为 20ms
`右滑`:0->1->-1->0
`左滑`:0->-1->1->0

## 交互流程策略分析

- 1 通过触摸板手势进行传感器切换和是否开启丢应的通道
- 2 创建一个公共的数组表，对他进行控制。

# 一、任务要求

- 使用板卡上的触摸按键，实现点按和左右滑动，实现传感器选择和切换，并将数据发送到上位机
- 功能选择的可视化也在上位机完成，在上位机端实现传感器的切换和通道使能

# 二、设计思路

- 4 个运动传感器和 3 个环境传感器的数据读取可以直接使用 ST 官方提供的驱动和示例配合，完成读取。
- QVAR 触摸板的手势判断可以使用简单的状态机完成左右单击、滑动、长按压这三种手势的判断
- 交互的上位机可以使用 QT 进行快速开发，甚至最后可以实现飞控那样酷炫的效果

# 三、实现过程

## 1、开发环境的搭建

使用 ST 官方的 CUBE 套件，cubemx 进行外设功能的初始化和添加传感器驱动。然后就可以快乐的开始我们的任务完成了~~~

## 2、NUCLEO 板的驱动对接

我本次任务所使用的 NUCLEO 板是 H743Z。超高的主频加上大容量 FLASH 和 RAM，用起来就是任性。本次的传感器通讯接口全是 I2C,并且挂在同一条总线上。再加上串口与上位机交互，这些就是任务所需要的所有底层外设了。但是，本着积极学习的想法，以及不浪费我这块板子上的百兆以太网口，所以我把 LWIP 协议栈加了进去，并使用 MQTT 进行与上位机的交互。

## 3、QVAR 读取状态机的实现

## 4、QT 上位机的实现

# 四、效果展示与遇到的问题
